---
layout: single
title: "[인공지능 4주차A] 휴리스틱의 Consistency"
categories: ArtificialIntelligence
tag: [AI, COSE361]
toc: true # table of contents
author_profile: false # 각 콘텐츠에서 프로필 여부
sidebar: # 사이드바 설정
    nav: "docs"
search: true # 검색 여부 설정
---
<head>
    <!-- Latex -->
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>
<style>
    th, td {
        text-align: center;
    }
    .r {
        color: red;
    }
</style>

## Sep 24(Tue)

지난 주에 우리는 optimal한 A* search를 위해서 admissibility가 보장되는 heuristic을 선택해야한다는 것을 배웠다. 그런데 해당 그래프는 사이클(cycle)이 없는 그래프였다. <strong class="r">과연 Cyclic한 그래프에서도 admissible한 휴리스틱은 여전히 optimal할까?</strong> (그러지 않으니 물어봤겠지?)

### Consistency of Heuristics

상태 공간 그래프(state space graph)를 탐색하는 데 사이클이 존재한다면, 자칫하다간 그 사이클을 벗어나지 못하고 뺑뺑 제자리를 돌 수 있다. 탐색 트리(search tree)에서도 여러 노드의 자식 노드에서 같은 subtrees가 발생하면서 무한히 갇히거나 비효율적 탐색을 하는 일이 발생할 수도 있다.

그래서 방문한 노드는 다시 탐색하지 않는다는 원칙 하에, closed set으로 방문 노드를 관리해보자. closed set에 등록이 된 노드라면 건너뛰고, 신규 노드라면 closed set에 추가 후 방문한다는 약속을 세워보자. 과연 완전탐색, 그리고 최적의 탐색이 가능할까?

![not_con]({{site.url}}/images/ArtInt/not_consistent.png)

최초 S노드에서 G노드로 가는 최적 경로를 A* search를 통해 찾아보자. 이때 휴리스틱은 admissible하도록 goal까지의 최적 비용보다 작거나 같게 설정한다.

먼저 탐색을 하기 전에 시작 노드인 S를 closed set에 넣는다. 이후 S의 f값을 계산해보면 g+h=0+2=2이다. 이제 탐색을 A와 B로 할 수 있는데 B에서의 f가 더 작으므로 경로 SB를 탐색하자. 노드 B를 closed set에 넣고 탐색을 해보니 경로 SBC와 SBS가 4로 같다. (경로 SA는 f가 5로 이미 후순위로 밀린 상태이다.)

그런데 closed set에 S가 방문한 노드라고 기록돼있으니 SBS를 우선순위 큐에서 삭제하고(정확힌 애초에 집어넣지 않고) SBC를 탐색해보자. 노드 C를 closed set에 넣고 탐색해보니 경로 SBCG와 SBCB가 보인다. 둘 다 f가 6이므로, 기존에 뒷 순위로 밀렸던 f값 5의 경로 SA를 탐색하는 걸로 돌아가자.

노드 A를 closed set에 집어넣고 SA를 탐색해보니, SAS와 SAC가 가능한데 S와 C 모두 closed set에 방문했다고 기록되어있다. 따라서 이 두 노드는 모두 탐색할 가치가 없으므로 우선순위 큐에 집어넣지 않는다. 그렇담 우선순위 큐의 맨 앞에 있는 경로는 이제 누굴까.

경로 SBCG이다. 노드 G를 closed set에 집어 넣고 G를 확인해보니 goal node다. 도착했다! 우리는 경로 SBCG를 cost=6으로 찾아냈다. 그런데 최적 경로는 cost=5의 SACG이다. 어라 실패다? <strong class="r">왜 optimal한 값을 못 찾았을까?</strong>

순회가 가능한 상태 공간 그래프에서는 admissibility 말고도 <strong class="r">Consistency</strong>를 고려해야한다. 어느 휴리스틱이 Consistent하다는 것은 모든 화살표(arc)에서 두 노드 간 휴리스틱의 차이가 실제 비용보다 작은지, 즉 <strong class="r">각각의 화살표에서 admissible</strong>함을 의미한다. 수식으로 표현한다면

$$\text{Admissibility: }h(A)\le \text{cost(A to G)}$$

$$\text{Consistency: }h(i)-h(j)\le \text{cost(i to j)}=g(j)-g(i), i\lt j$$

그리고 부등식을 살짝 옮겨서

$$\begin{align} \text{Consequences of consistency: }h(i)&\le h(j)+\text{cost(i to j)} \\&= h(j)+g(j)-g(i),\forall (i\lt j) \end{align}$$

모든 구간에서 consistency가 보장되는, 즉 <strong class="r">f값이 단조증가(monotonic)할 경우 Consequences of consistency</strong>라 한다. 따라서 일반적으로 consistency가 연속적으로 보장되면, 모든 구간에서 admissibility가 보장된다고 볼 수 있다. 역명제는 성립하지 않는다.

<strong class="r">cyclic한 state graph에서 consistency가 연속적으로 보장되면, A* search는 optimal하다!</strong> 앞선 예에서 노드 A의 h를 2로 조정하면 모든 구간에서 consistency가 보장된다. optimal한 경로 SACG도 잘 찾는다.

이를 그래프로 표현하자면 노드 N1과 N2에서의 h값과 g값을 각각 h(N1), h(N2), c(N1), c(N2)라 할 때,

$$c(N_2)-c(N_1)\ge h(N_1)-h(N_2), \forall (N_1\lt N_2)$$

하다는 것이다. 여기서 h는 admissibility와, c는 consistency와 관련이 있다. 또한 c는 누적 비용이므로 N2에서 더 크지만, h는 heuristic이므로 N1에서 더 크기에 부등식의 순서에 유의하자.

물론 일반적으로 relaxed problem에서 admissible한 휴리스틱은 consistent한 경향이 있다. 그러나 항상 그렇지 않으므로 '역명제는 성립하지 않는다'고 상술하였다.

<strong class="r"> </strong>



